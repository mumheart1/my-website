<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Exploding Cows Arena</title>
  <style>
    body { margin: 0; overflow: hidden; background: #111; }
    canvas { display: block; }
  </style>
</head>
<body>
  <script type="module">
    import * as THREE from 'https://cdn.skypack.dev/three';
    import { OrbitControls } from 'https://cdn.skypack.dev/three/examples/jsm/controls/OrbitControls.js';
    import * as CANNON from 'https://cdn.skypack.dev/cannon-es';

    let scene = new THREE.Scene();
    let camera = new THREE.PerspectiveCamera(75, window.innerWidth/window.innerHeight, 0.1, 1000);
    let renderer = new THREE.WebGLRenderer();
    renderer.setSize(window.innerWidth, window.innerHeight);
    document.body.appendChild(renderer.domElement);

    let controls = new OrbitControls(camera, renderer.domElement);
    camera.position.set(0, 15, 20);
    controls.target.set(0, 0, 0);
    controls.update();

    // Lighting
    const light = new THREE.DirectionalLight(0xffffff, 1);
    light.position.set(5, 10, 7.5);
    scene.add(light);
    scene.add(new THREE.AmbientLight(0x404040));

    // Physics world
    const world = new CANNON.World({
      gravity: new CANNON.Vec3(0, -9.82, 0),
    });

    // Ground
    const groundBody = new CANNON.Body({
      shape: new CANNON.Plane(),
      mass: 0,
    });
    groundBody.quaternion.setFromEuler(-Math.PI / 2, 0, 0);
    world.addBody(groundBody);

    const groundGeo = new THREE.PlaneGeometry(50, 50);
    const groundMat = new THREE.MeshStandardMaterial({ color: 0x228822 });
    const groundMesh = new THREE.Mesh(groundGeo, groundMat);
    groundMesh.rotation.x = -Math.PI / 2;
    scene.add(groundMesh);

    // Create cow (sphere for now)
    function createCow(color, x, z) {
      const radius = 1;
      const mat = new THREE.MeshStandardMaterial({ color });
      const mesh = new THREE.Mesh(new THREE.SphereGeometry(radius, 16, 16), mat);
      mesh.position.set(x, radius, z);
      scene.add(mesh);

      const body = new CANNON.Body({
        mass: 1,
        shape: new CANNON.Sphere(radius),
        position: new CANNON.Vec3(x, radius, z),
        linearDamping: 0.2,
      });
      world.addBody(body);

      return { mesh, body };
    }

    const player = createCow(0xff4444, -5, 0);
    const bot = createCow(0x4444ff, 5, 0);

    // Movement controls
    const keys = {};
    window.addEventListener('keydown', e => keys[e.key.toLowerCase()] = true);
    window.addEventListener('keyup', e => keys[e.key.toLowerCase()] = false);

    function handlePlayerInput() {
      const force = 10;
      if (keys['w']) player.body.applyForce(new CANNON.Vec3(0, 0, -force), player.body.position);
      if (keys['s']) player.body.applyForce(new CANNON.Vec3(0, 0, force), player.body.position);
      if (keys['a']) player.body.applyForce(new CANNON.Vec3(-force, 0, 0), player.body.position);
      if (keys['d']) player.body.applyForce(new CANNON.Vec3(force, 0, 0), player.body.position);
    }

    // AI logic
    function updateBotAI() {
      const toPlayer = player.body.position.vsub(bot.body.position);
      toPlayer.y = 0;
      toPlayer.normalize();
      toPlayer.scale(5, toPlayer);
      bot.body.applyForce(toPlayer, bot.body.position);
    }

    // Sync physics and visuals
    function updateMeshFromBody(obj) {
      obj.mesh.position.copy(obj.body.position);
      obj.mesh.quaternion.copy(obj.body.quaternion);
    }

    // Game loop
    function animate() {
      requestAnimationFrame(animate);
      handlePlayerInput();
      updateBotAI();

      world.step(1/60);
      updateMeshFromBody(player);
      updateMeshFromBody(bot);

      renderer.render(scene, camera);
    }

    animate();
  </script>
</body>
</html>
